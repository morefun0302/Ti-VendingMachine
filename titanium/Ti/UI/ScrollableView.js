define(["Ti/_/declare","Ti/UI/View","Ti/_/dom","Ti/_/style","Ti/UI","Ti/_/browser"],function(e,t,i,n,r,o){var a=n.set,s=require.is,l=i.unitize,c=require.on,u=c.once,d=window,h={webkit:"webkitTransitionEnd",trident:"msTransitionEnd",gecko:"transitionend",presto:"oTransitionEnd"},_=h[o.runtime]||"transitionEnd",f="ontouchstart"in d,p=200,g=10,v=25,m=1e3,T=.5,y=2;return e("Ti.UI.ScrollableView",t,{constructor:function(){var e,t=this,i=0;t._add(t._contentContainer=r.createView({left:0,top:0,width:r.SIZE,height:"100%",layout:"constrainingHorizontal"})),e=t._contentContainer.domNode,t._add(t._pagingControlContainer=r.createView({width:"100%",height:20,bottom:0,backgroundColor:"black",opacity:0,touchEnabled:!1})),t._pagingControlContainer._add(t._pagingControlContentContainer=r.createView({width:r.SIZE,height:"100%",top:0,touchEnabled:!1,layout:"constrainingHorizontal"})),t.properties.__values__.views=[],t._viewToRemoveAfterScroll=-1,c(t,"postlayout",function(){t._animating||t._setTranslation(t.currentPage*-t._measuredWidth)}),c(e,f?"touchstart":"mousedown",function(n){var r=n.touches?n.touches[0].clientX:n.clientX,o=r,s=Date.now(),l=t._measuredWidth,c=function(e){var n=t.currentPage,a=o-r+i;l=t._measuredWidth,e.preventDefault(),o=e.touches?e.touches[0].clientX:e.clientX,t._setTranslation(n*-l+a),t.fireEvent("scroll",{currentPage:n,currentPageAsFloat:n-a/l,view:t.views[n]})},h=function(n){var w=Date.now(),E=p>w-s,I=t.currentPage,b=Math.abs(r-o)>(E?g:l/2),S=t.properties.__values__,A=Math.abs(o-r);d.removeEventListener(f?"touchmove":"mousemove",c),d.removeEventListener(f?"touchend":"mouseup",h),l=t._measuredWidth,t._animating=1,n.preventDefault(),b&&(r>o?I!==S.views.length-1&&I++:0!==I&&I--,A=l-A),t._showPagingControl(I),i=o-r+i,A=Math.max(v,Math.min(m,(E?T:y)*A)),a(e,"transition",A+"ms ease-out"),setTimeout(function(){u(e,_,function(){a(e,"transition",""),t._animating=0,S.currentPage=I,t._updatePagingControl(),t.fireEvent("scrollend",{currentPage:I,view:t.views[I]})}),t._setTranslation(I*-l)},1),t.fireEvent("dragend",{currentPage:I,view:t.views[I]})};t._showPagingControl(t.currentPage,1),n.preventDefault(),i=t._animating?i||0:0,a(e,"transition",""),t._setTranslation(t.currentPage*-l+i),t._animating=0,d.addEventListener(f?"touchmove":"mousemove",c),d.addEventListener(f?"touchend":"mouseup",h),t.fireEvent("dragstart")})},_setTranslation:function(e){a(this._contentContainer.domNode,"transform","translatez(0) translatex("+e+"px)")},_showPagingControl:function(e,t){var i=this;return i.showPagingControl?(i._pagingAnimation&&i._pagingAnimation.cancel(),i._pagingAnimation=i._pagingControlContainer.animate({duration:250,opacity:.75}),clearInterval(i._pagingTimeout),!t&&i.pagingControlTimeout>0?i._pagingTimeout=setTimeout(function(){i._pagingAnimation&&i._pagingAnimation.cancel(),i._pagingAnimation=i._pagingControlContainer.animate({duration:750,opacity:0},function(){i._pagingAnimation=void 0})},i.pagingControlTimeout):i._pagingAnimation=void 0,void 0):(i._pagingControlContainer.opacity=0,void 0)},_updatePagingControl:function(){var e=this._pagingControlContentContainer,t=this.views.length,i=this.pagingControlHeight/2;if(t!==e._numViews||i!==e._diameter){e._numViews=t,e._diameter=i,e._removeAllChildren();for(var n=0;this.views.length>n;n++)e._add(r.createView({width:i,height:i,left:5,right:5,backgroundColor:"#aaa",borderRadius:l(i/2)}));e._highlightedPage=-1}e._highlightedPage!==this.currentPage&&(0>e._highlightedPage||(e._children[e._highlightedPage].backgroundColor="#aaa"),e._children[this.currentPage].backgroundColor="#fff",e._highlightedPage=this.currentPage)},addView:function(e){e&&(e.width="100%",e.height="100%",this.views.push(e),this._contentContainer._add(e),1==this.views.length&&(this.properties.__values__.currentPage=0),this._updatePagingControl())},removeView:function(e){var t=s(e,"Number")?e:this.views.indexOf(e);0>t||t>=this.views.length||(t==this.currentPage&&1!==this.views.length?(this._viewToRemoveAfterScroll=t,this.scrollToView(t==this.views.length-1?--t:++t)):this._removeViewFromList(t))},_removeViewFromList:function(e){var t=this._contentContainer,i=this;this.currentPage>e&&i.properties.__values__.currentPage--,t._remove(i.views.splice(e,1)[0]),i.views.length||(i.properties.__values__.currentPage=-1),u(r,"postlayout",function(){setTimeout(function(){i._setTranslation(i.currentPage*-i._measuredWidth)},1)})},scrollToView:function(e,t){function i(){var e=r._contentContainer,i=e.domNode,o=-r.views[n]._measuredLeft,s=Math.max(v,Math.min(m,y*e._measuredWidth));r._updatePagingControl(),r._showPagingControl(n),t?(r._setTranslation(o),r.properties.__values__.currentPage=n):(a(i,"transition",s+"ms ease-out"),setTimeout(function(){u(i,_,function(){a(i,"transition",""),r._animating=0,r.properties.__values__.currentPage=n,r._updatePagingControl(),-1!==r._viewToRemoveAfterScroll&&(o+=r.views[r._viewToRemoveAfterScroll]._measuredWidth,r._removeViewFromList(r._viewToRemoveAfterScroll),r._viewToRemoveAfterScroll=-1),r.fireEvent("scrollend",{currentPage:n,view:r.views[n]})}),r._setTranslation(o)},1))}var n=s(e,"Number")?e:this.views.indexOf(e),r=this;0>n||n>=this.views.length||n==this.currentPage||(r._contentContainer.domNode.offsetWidth?i():u(r,"postlayout",i))},_defaultWidth:r.FILL,_defaultHeight:r.FILL,properties:{currentPage:{set:function(e,t){return e>=0&&this.views.length>e?(this.scrollToView(e,1),e):t},value:-1},pagingControlColor:{set:function(e){return this._pagingControlContainer.backgroundColor=e,e},value:"black"},pagingControlHeight:{set:function(e){return this._pagingControlContainer.height=e,e},value:20},pagingControlTimeout:{post:function(e){e||(this._pagingControlContainer.opacity=.75)},value:3e3},showPagingControl:!1,views:{set:function(e){if(s(e,"Array")){var t,i=0,n=e.length,r=this._contentContainer;for(r._removeAllChildren();n>i;i++)(t=e[i]).width="100%",t.height="100%",r._add(t);return this.properties.__values__.currentPage=n?0:-1,e}},post:"_updatePagingControl"}}})});