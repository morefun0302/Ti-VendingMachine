define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(t,e,i,n){var r=n.isDef,o=Math.round;return e("Ti._.Layouts.ConstrainingHorizontal",t,{_doLayout:function(t,e,n,r,a){var s,c,l,u,d,h,_,f,p,g,v,m,T,y,b,w,I,E={width:0,height:0},S=t._children,x=0,C="px",A=[],N=0,L=0,O=S.length,k=this._measureNode;for(x=0;O>x;x++)s=t._children[x],s._alive&&s.domNode?s._markedForLayout&&((s._preLayout&&s._preLayout(e,n,r,a)||s._needsMeasuring)&&k(s,s,s._layoutCoefficients,this),c=s._layoutCoefficients,l=c.width,0===l.x2||isNaN(l.x2)?(u=c.height,d=c.sandboxWidth,h=c.sandboxHeight,v=u.x1*n+u.x2,g=l.x1*e+l.x2*(e-N)+l.x3,p=s._getContentSize?s._getContentSize(g,v):s._layout._doLayout(s,isNaN(g)?e:g-s._borderLeftWidth-s._borderRightWidth,isNaN(v)?n:v-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(v)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(v)&&(v=p.height+s._borderTopWidth+s._borderBottomWidth),T=s._measuredSandboxWidth=d.x1*e+d.x2+g,N+=T,s._measuredWidth=g,s._measuredHeight=v):L++):this.handleInvalidState(s,t);for(w=e-N,N=Math.floor(w/L),x=0;O>x;x++)s=t._children[x],s._markedForLayout&&(c=s._layoutCoefficients,l=c.width,0===l.x2||isNaN(l.x2)||(u=c.height,d=c.sandboxWidth,h=c.sandboxHeight,v=u.x1*n+u.x2,g=l.x1*e+l.x2*(O-1>x?N:w-N*(L-1))+l.x3,p=s._getContentSize?s._getContentSize(g,v):s._layout._doLayout(s,isNaN(g)?e:g-s._borderLeftWidth-s._borderRightWidth,isNaN(v)?n:v-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(v)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(v)&&(v=p.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=g,s._measuredHeight=v,T=s._measuredSandboxWidth=d.x1*e+d.x2+g));for(N=0,x=0;O>x;x++)s=t._children[x],s._measuredRunningWidth=N,s._markedForLayout?(c=s._layoutCoefficients,h=c.sandboxHeight,_=c.top,f=c.left,a&&0!==_.x1?A.push(s):(v=s._measuredHeight,b=s._measuredTop=_.x1*n+_.x2*v+_.x3,m=s._measuredSandboxHeight=h.x1*n+h.x2+v+(isNaN(b)?0:b),s._measuredSandboxHeight>E.height&&(E.height=s._measuredSandboxHeight)),y=s._measuredLeft=f.x1*e+f.x2+N):s._measuredSandboxHeight>E.height&&(E.height=s._measuredSandboxHeight),N+=s._measuredSandboxWidth;for(E.width=N,O=A.length,x=0;O>x;x++)s=A[x],h=s._layoutCoefficients.sandboxHeight,m=s._measuredSandboxHeight=h.x1*n+h.x2+s._measuredHeight,m>E.height&&(E.height=m);for(x=0;O>x;x++)s=A[x],_=s._layoutCoefficients.top,h=s._layoutCoefficients.sandboxHeight,v=s._measuredHeight,m=s._measuredSandboxHeight,m>E.height&&(E.height=m),b=s._measuredTop=_.x1*E.height+_.x2*v+_.x3,s._measuredSandboxHeight+=isNaN(b)?0:b;for(O=S.length,x=0;O>x;x++)s=S[x],s._markedForLayout&&(i._elementLayoutCount++,s=S[x],I=s.domNode.style,I.zIndex=s.zIndex,I.left=o(s._measuredLeft)+C,I.top=o(s._measuredTop)+C,I.width=o(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+C,I.height=o(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+C,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=E},_getWidth:function(t,e){return!r(e)&&(e=t._defaultWidth),e===i.INHERIT?t._parent._parent?t._parent._parent._layout._getWidth(t._parent,t._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:e},_getHeight:function(t,e){return!r(e)&&2>r(t.top)+r(t.center&&t.center.y)+r(t.bottom)&&(e=t._defaultHeight),e===i.INHERIT?t._parent._parent?t._parent._parent._layout._getHeight(t._parent,t._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:e},_isDependentOnParent:function(t){var e=t._layoutCoefficients;return!isNaN(e.width.x1)&&0!==e.width.x1||!isNaN(e.width.x2)&&0!==e.width.x2||!isNaN(e.height.x1)&&0!==e.height.x1||0!==e.sandboxWidth.x1||0!==e.sandboxHeight.x1||0!==e.left.x1||0!==e.top.x1},_doAnimationLayout:function(t,e){var i=t._parent._measuredWidth,n=t._parent._measuredHeight,r=t._measuredRunningWidth,o=e.height.x1*n+e.height.x2;return{width:e.width.x1*i+e.width.x2*(i-r)+e.width.x3,height:o,left:e.left.x1*i+e.left.x2+r,top:e.top.x1*n+e.top.x2*o+e.top.x3}},_measureNode:function(t,e,n,r){t._needsMeasuring=!1;var o,a,s,c=r.getValueType,l=r.computeValue,u=r._getWidth(t,e.width),d=c(u),h=l(u,d),_=r._getHeight(t,e.height),f=c(_),p=l(_,f),g=e.left,v=c(g),m=l(g,v),T=e.right,y=c(T),b=l(T,y),w=e.top,I=c(w),E=l(w,I),S=e.center&&e.center.y,x=c(S),C=l(S,x),A=e.bottom,N=c(A),L=l(A,N),O=n.width,k=n.height,R=n.sandboxWidth,D=n.sandboxHeight,U=n.left,P=n.top;if(o=a=0,f===i.SIZE?o=a=0/0:f===i.FILL?(o=1,"%"===I?o-=E:"#"===I?a=-E:"%"===N?o-=L:"#"===N&&(a=-L)):"%"===f?o=p:"#"===f?a=p:"%"===I?"%"===x?o=2*(C-E):"#"===x?(o=-2*E,a=2*C):"%"===N?o=1-E-L:"#"===N&&(o=1-E,a=-L):"#"===I?"%"===x?(o=2*C,a=-2*E):"#"===x?a=2*(C-E):"%"===N?(o=1-L,a=-E):"#"===N&&(o=1,a=-L-E):"%"===x?"%"===N?o=2*(L-C):"#"===N&&(o=-2*C,a=2*L):"#"===x&&("%"===N?(o=2*L,a=-2*C):"#"===N&&(a=2*(L-C))),k.x1=o,k.x2=a,D.x1="%"===N?L:0,D.x2="#"===N?L:0,o=a=s=0,d===i.SIZE?o=a=s=0/0:d===i.FILL?(a=1,"%"===v&&(o=-m),"#"===v&&(s=-m),"%"===y&&(o=-b),"#"===y&&(s=-b)):"%"===d?o=h:"#"===d&&(s=h),O.x1=o,O.x2=a,O.x3=s,o=a=0,"%"===v&&(o=m),"#"===v&&(a=m),"%"===y&&(o+=b),"#"===y&&(a+=b),R.x1=o,R.x2=a,o=a=s=0,"%"===I)o=E;else if("#"===I)s=E;else if("%"===x)o=C,a=-.5;else if("#"===x)a=-.5,s=C;else if("%"===N)o=1-L,a=-1;else if("#"===N)o=1,a=-1,s=-L;else switch(r._defaultVerticalAlignment){case"center":o=.5,a=-.5;break;case"end":o=1,a=-1}P.x1=o,P.x2=a,P.x3=s,U.x1="%"===v?m:0,U.x2="#"===v?m:0},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"center"})});