define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/API","Ti/UI","Ti/_/lang"],function(t,e,i,n,r){var o=r.isDef,a=Math.round,s=Math.floor,c=Math.ceil;return e("Ti._.Layouts.Horizontal",t,{_doLayout:function(t,e,r,o,l){var u,d,h,_,f,p,g,m,v,T,y,b,w,I,E,x,S,N,C,A,L={width:0,height:0},O=t._children,k=0,R="px",D=0,U=0,P=[[]],W=[],M=[],B=0,V=O.length,F=this._measureNode;for(k=0;V>k;k++)u=t._children[k],u._alive&&u.domNode?(u._measuredRunningWidth=U,u._markedForLayout&&((u._preLayout&&u._preLayout(e,r,o,l)||u._needsMeasuring)&&F(u,u,u._layoutCoefficients,this),h=u._layoutCoefficients,_=h.width,f=h.height,p=h.sandboxWidth,v=h.left,y=_.x1*e+_.x2*(e-U)+_.x3,b=0===f.x2?f.x1*r+f.x3:0/0,isNaN(y)||isNaN(f.x1)?(T=u._getContentSize?u._getContentSize(y,b):u._layout._doLayout(u,isNaN(y)?e:y-u._borderLeftWidth-u._borderRightWidth,isNaN(b)?r:b-u._borderTopWidth-u._borderBottomWidth,isNaN(y),isNaN(b)),isNaN(y)&&(y=T.width+u._borderLeftWidth+u._borderRightWidth),isNaN(f.x1)&&(b=T.height+u._borderTopWidth+u._borderBottomWidth),u._childrenLaidOut=!0,0===f.x2||isNaN(f.x2)||(i.warn("Child of width SIZE and height FILL detected in a horizontal layout. Performance degradation may occur."),u._childrenLaidOut=!1)):u._childrenLaidOut=!1,u._measuredWidth=y,u._measuredHeight=b,I=u._measuredSandboxWidth=p.x1*e+p.x2+y,E=v.x1*e+v.x2+U,!o&&s(I+U)>c(e)&&(P.push([]),E-=U,U=0),u._measuredLeft=E,P[P.length-1].push(u),U+=I),U>L.width&&(L.width=U)):this.handleInvalidState(u,t);for(V=P.length,k=0;V>k;k++){for(S=P[k],N=0,C=S.length,d=0;C>d;d++)u=S[d],u._markedForLayout&&(h=u._layoutCoefficients,m=h.top,f=h.height,g=h.sandboxHeight,b=u._measuredHeight,isNaN(b)&&(u._measuredHeight=b=f.x1*r+f.x2*(r-D)+f.x3),u._childrenLaidOut||(y=u._measuredWidth,u._childrenLaidOut=!0,u._layout._doLayout(u,isNaN(y)?e:y-u._borderLeftWidth-u._borderRightWidth,isNaN(b)?r:b-u._borderTopWidth-u._borderBottomWidth,isNaN(y),isNaN(b))),0!==m.x2?(M.push(u),x=D):u._measuredTop=x=m.x1*r+m.x3*b+m.x4+D,u._measuredSandboxHeight=w=g.x1*r+g.x2+b+x-D,w>N&&(N=w));W.push(N),D+=N}for(D=0,V=P.length,k=0;V>k;k++){for(S=P[k],N=W[k],C=S.length,d=0;C>d;d++)u=S[d],u._measuredRunningHeight=D,u._measuredRowHeight=N,~M.indexOf(u)&&u._markedForLayout&&(b=u._measuredHeight,m=u._layoutCoefficients.top,u._measuredTop=m.x1*r+m.x2*N+m.x3*b+m.x4+D);D+=N}if(L.height=D,!l)switch(this._defaultVerticalAlignment){case"end":B=r-D;case"center":B/=2}for(V=O.length,k=0;V>k;k++)u=O[k],u._markedForLayout&&(n._elementLayoutCount++,u=O[k],A=u.domNode.style,A.zIndex=u.zIndex,A.left=a(u._measuredLeft)+R,A.top=a(u._measuredTop)+R,A.width=a(u._measuredWidth-u._borderLeftWidth-u._borderRightWidth)+R,A.height=a(u._measuredHeight-u._borderTopWidth-u._borderBottomWidth)+R,u._markedForLayout=!1,u.fireEvent("postlayout"));return this._computedSize=L},_getWidth:function(t,e){return!o(e)&&(e=t._defaultWidth),e===n.INHERIT?t._parent._parent?t._parent._parent._layout._getWidth(t._parent,t._parent.width)===n.SIZE?n.SIZE:n.FILL:n.FILL:e},_getHeight:function(t,e){return!o(e)&&(e=t._defaultHeight),e===n.INHERIT?t._parent._parent?t._parent._parent._layout._getHeight(t._parent,t._height)===n.SIZE?n.SIZE:n.FILL:n.FILL:e},_isDependentOnParent:function(t){var e=t._layoutCoefficients;return!isNaN(e.width.x1)&&0!==e.width.x1||!isNaN(e.width.x2)&&0!==e.width.x2||!isNaN(e.height.x1)&&0!==e.height.x1||!isNaN(e.height.x2)&&0!==e.height.x2||0!==e.sandboxWidth.x1||0!==e.sandboxHeight.x1||0!==e.left.x1||0!==e.top.x1},_doAnimationLayout:function(t,e){var i=t._parent._measuredWidth,n=t._parent._measuredHeight,r=t._measuredHeight,o=t._measuredRunningWidth,a=t._measuredRunningHeight,s=t._measuredRowHeight;return{width:e.width.x1*i+e.width.x2*(i-o)+e.width.x3,height:e.height.x1*n+e.height.x2*(n-a)+e.height.x3,left:e.left.x1*i+e.left.x2+o,top:e.top.x1*n+e.top.x2*s+e.top.x3*r+e.top.x4+a}},_measureNode:function(t,e,i,r){t._needsMeasuring=!1;var o,a,s,c,l=r.getValueType,u=r.computeValue,d=r._getWidth(t,e.width),h=l(d),_=u(d,h),f=r._getHeight(t,e.height),p=l(f),g=u(f,p),m=e.left,v=l(m),T=u(m,v),y=e.right,b=l(y),w=u(y,b),I=e.top,E=l(I),x=u(I,E),S=e.bottom,N=l(S),C=u(S,N),A=i.width,L=i.height,O=i.sandboxWidth,k=i.sandboxHeight,R=i.left,D=i.top;if(o=a=s=0,h===n.SIZE?o=a=s=0/0:h===n.FILL?(a=1,"%"===v&&(o=-T),"#"===v&&(s=-T),"%"===b&&(o=-w),"#"===b&&(s=-w)):"%"===h?o=_:"#"===h&&(s=_),A.x1=o,A.x2=a,A.x3=s,o=a=0,"%"===v&&(o=T),"#"===v&&(a=T),"%"===b&&(o+=w),"#"===b&&(a+=w),O.x1=o,O.x2=a,o=a=s=0,p===n.SIZE?o=a=s=0/0:p===n.FILL?(a=1,"%"===E&&(o=-x),"#"===E&&(s=-x)):"%"===p?o=g:"#"===p&&(s=g),L.x1=o,L.x2=a,L.x3=s,k.x1="%"===N?C:0,k.x2="#"===N?C:0,R.x1="%"===v?T:0,R.x2="#"===v?T:0,o=a=s=c=0,"%"===E)o=x;else if("#"===E)c=x;else if("%"===N)o=1-C,s=-1;else if("#"===N)o=1,s=-1,c=-C;else switch(r._defaultRowAlignment){case"center":a=.5,s=-.5;break;case"end":a=1,s=-1}D.x1=o,D.x2=a,D.x3=s,D.x4=c},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"start",_defaultRowAlignment:"center"})});