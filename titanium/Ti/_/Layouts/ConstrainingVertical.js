define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(t,e,i,n){var r=n.isDef,o=Math.round;return e("Ti._.Layouts.ConstrainingVertical",t,{_doLayout:function(t,e,n,r,a){var s,c,l,u,d,h,_,f,p,g,m,v,T,y,b,w,I,E={width:0,height:0},x=t._children,S=0,C="px",N=[],A=0,L=0,O=x.length,k=this._measureNode;for(S=0;O>S;S++)s=t._children[S],s._alive&&s.domNode?s._markedForLayout&&((s._preLayout&&s._preLayout(e,n,r,a)||s._needsMeasuring)&&k(s,s,s._layoutCoefficients,this),c=s._layoutCoefficients,u=c.height,0===u.x2||isNaN(u.x2)?(l=c.width,d=c.sandboxWidth,h=c.sandboxHeight,g=l.x1*e+l.x2,m=u.x1*n+u.x2*(n-A)+u.x3,p=s._getContentSize?s._getContentSize(g,m):s._layout._doLayout(s,isNaN(g)?e:g-s._borderLeftWidth-s._borderRightWidth,isNaN(m)?n:m-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(m)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(m)&&(m=p.height+s._borderTopWidth+s._borderBottomWidth),v=s._measuredSandboxHeight=h.x1*n+h.x2+m,A+=v,s._measuredWidth=g,s._measuredHeight=m):L++):this.handleInvalidState(s,t);for(w=n-A,A=Math.floor(w/L),S=0;O>S;S++)s=t._children[S],s._markedForLayout&&(c=s._layoutCoefficients,u=c.height,0===u.x2||isNaN(u.x2)||(l=c.width,d=c.sandboxWidth,h=c.sandboxHeight,g=l.x1*e+l.x2,m=u.x1*n+u.x2*(O-1>S?A:w-A*(L-1))+u.x3,p=s._getContentSize?s._getContentSize(g,m):s._layout._doLayout(s,isNaN(g)?e:g-s._borderLeftWidth-s._borderRightWidth,isNaN(m)?n:m-s._borderTopWidth-s._borderBottomWidth,isNaN(g),isNaN(m)),isNaN(g)&&(g=p.width+s._borderLeftWidth+s._borderRightWidth),isNaN(m)&&(m=p.height+s._borderTopWidth+s._borderBottomWidth),s._measuredWidth=g,s._measuredHeight=m,v=s._measuredSandboxHeight=h.x1*n+h.x2+m));for(A=0,S=0;O>S;S++)s=t._children[S],s._measuredRunningHeight=A,s._markedForLayout?(c=s._layoutCoefficients,d=c.sandboxWidth,_=c.top,f=c.left,r&&0!==f.x1?N.push(s):(g=s._measuredWidth,y=s._measuredLeft=f.x1*e+f.x2*g+f.x3,T=s._measuredSandboxWidth=d.x1*e+d.x2+g+(isNaN(y)?0:y),s._measuredSandboxWidth>E.width&&(E.width=s._measuredSandboxWidth)),b=s._measuredTop=_.x1*n+_.x2+A):s._measuredSandboxWidth>E.width&&(E.width=s._measuredSandboxWidth),A+=s._measuredSandboxHeight;for(E.height=A,O=N.length,S=0;O>S;S++)s=N[S],d=s._layoutCoefficients.sandboxWidth,T=s._measuredSandboxWidth=d.x1*e+d.x2+s._measuredWidth,T>E.width&&(E.width=T);for(S=0;O>S;S++)s=N[S],f=s._layoutCoefficients.left,d=s._layoutCoefficients.sandboxWidth,g=s._measuredWidth,T=s._measuredSandboxWidth,T>E.width&&(E.width=T),y=s._measuredLeft=f.x1*E.width+f.x2*g+f.x3,s._measuredSandboxWidth+=isNaN(y)?0:y;for(O=x.length,S=0;O>S;S++)s=x[S],s._markedForLayout&&(i._elementLayoutCount++,s=x[S],I=s.domNode.style,I.zIndex=s.zIndex,I.left=o(s._measuredLeft)+C,I.top=o(s._measuredTop)+C,I.width=o(s._measuredWidth-s._borderLeftWidth-s._borderRightWidth)+C,I.height=o(s._measuredHeight-s._borderTopWidth-s._borderBottomWidth)+C,s._markedForLayout=!1,s.fireEvent("postlayout"));return this._computedSize=E},_getWidth:function(t,e){return!r(e)&&2>r(t.left)+r(t.center&&t.center.x)+r(t.right)&&(e=t._defaultWidth),e===i.INHERIT?t._parent._parent?t._parent._parent._layout._getWidth(t._parent,t._parent.width)===i.SIZE?i.SIZE:i.FILL:i.FILL:e},_getHeight:function(t,e){return!r(e)&&(e=t._defaultHeight),e===i.INHERIT?t._parent._parent?t._parent._parent._layout._getHeight(t._parent,t._parent.height)===i.SIZE?i.SIZE:i.FILL:i.FILL:e},_isDependentOnParent:function(t){var e=t._layoutCoefficients;return!isNaN(e.width.x1)&&0!==e.width.x1||!isNaN(e.height.x1)&&0!==e.height.x1||!isNaN(e.height.x2)&&0!==e.height.x2||0!==e.sandboxWidth.x1||0!==e.sandboxHeight.x1||0!==e.left.x1||0!==e.top.x1},_doAnimationLayout:function(t,e){var i=t._parent._measuredWidth,n=t._parent._measuredHeight,r=t._measuredRunningHeight,o=e.width.x1*i+e.width.x2;return{width:o,height:e.height.x1*n+e.height.x2*(n-r)+e.height.x3,left:e.left.x1*i+e.left.x2*o+e.left.x3,top:e.top.x1*n+e.top.x2+r}},_measureNode:function(t,e,n,r){t._needsMeasuring=!1;var o,a,s,c=r.getValueType,l=r.computeValue,u=r._getWidth(t,e.width),d=c(u),h=l(u,d),_=r._getHeight(t,e.height),f=c(_),p=l(_,f),g=e.left,m=c(g),v=l(g,m),T=e.center&&e.center.x,y=c(T),b=l(T,y),w=e.right,I=c(w),E=l(w,I),x=e.top,S=c(x),C=l(x,S),N=e.bottom,A=c(N),L=l(N,A),O=n.width,k=n.height,R=n.sandboxWidth,D=n.sandboxHeight,U=n.left,P=n.top;if(o=a=0,d===i.SIZE?o=a=0/0:d===i.FILL?(o=1,"%"===m?o-=v:"#"===m?a=-v:"%"===I?o-=E:"#"===I&&(a=-E)):"%"===d?o=h:"#"===d?a=h:"%"===m?"%"===y?o=2*(b-v):"#"===y?(o=-2*v,a=2*b):"%"===I?o=1-v-E:"#"===I&&(o=1-v,a=-E):"#"===m?"%"===y?(o=2*b,a=-2*v):"#"===y?a=2*(b-v):"%"===I?(o=1-E,a=-v):"#"===I&&(o=1,a=-E-v):"%"===y?"%"===I?o=2*(E-b):"#"===I&&(o=-2*b,a=2*E):"#"===y&&("%"===I?(o=2*E,a=-2*b):"#"===I&&(a=2*(E-b))),O.x1=o,O.x2=a,R.x1="%"===I?E:0,R.x2="#"===I?E:0,o=a=s=0,f===i.SIZE?o=a=s=0/0:f===i.FILL?(a=1,"%"===S&&(o=-C),"#"===S&&(s=-C),"%"===A&&(o=-L),"#"===A&&(s=-L)):"%"===f?o=p:"#"===f&&(s=p),k.x1=o,k.x2=a,k.x3=s,o=a=0,"%"===S&&(o=C),"#"===S&&(a=C),"%"===A&&(o+=L),"#"===A&&(a+=L),D.x1=o,D.x2=a,o=a=s=0,"%"===m)o=v;else if("#"===m)s=v;else if("%"===y)o=b,a=-.5;else if("#"===y)a=-.5,s=b;else if("%"===I)o=1-E,a=-1;else if("#"===I)o=1,a=-1,s=-E;else switch(r._defaultHorizontalAlignment){case"center":o=.5,a=-.5;break;case"end":o=1,a=-1}U.x1=o,U.x2=a,U.x3=s,P.x1="%"===S?C:0,P.x2="#"===S?C:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});