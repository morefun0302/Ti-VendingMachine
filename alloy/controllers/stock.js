function Controller(){function t(t){var n=u.stock.levels,r=_.find(n,function(e){return e.name==t});d=t,l.stockTitle.text="Stock "+t,l.stockLevel.text=r.qty,l.stockSlider.value=r.qty,l.stockSlider.addEventListener("change",e),i()}function e(t){var e=u.stock.levels,i=Math.round(t.value);l.stockLevel.text=i;var n=_.find(e,function(t){return t.name==d});Ti.API.info("slider changed: "+n),n.qty=i,r(e)}function i(){l.stockOverlayWrapper.visible=!0}function n(){l.stockOverlayWrapper.visible=!1,l.stockSlider.removeEventListener("change",e),d=void 0}function r(t){_.each(t,function(t){var e=_.find(p,function(e){return e.item.name==t.name});e.stockLevel.text=t.qty,t.qty>0?(e.bg.backgroundColor="green",e.bg.opacity=.3,e.stockLevel.color="white",Ti.API.info("there is stock")):(e.bg.backgroundColor="red",e.bg.opacity=.3,e.stockLevel.color="red",Ti.API.info("no stock"))})}function s(e){var i=[{name:"Sweets",height:57},{name:"Crisps",height:56},{name:"Cakes",height:48},{name:"Bottles",height:82},{name:"Cans",height:72}];_.each(e,function(e){var n=_.find(i,function(t){return e.name==t.name}),r=Alloy.createController("vendItem",{width:172,height:n.height,bottom:4,item:e,click:t});l.itemWrapper.add(r.getView()),p.push(r)})}function o(){u.switchMode(u.modes.STOCK),r(u.stock.levels)}function a(){var t=u.stock.levels;s(t),r(t)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="stock",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var l=this,c={},h={};l.__views.stock=Ti.UI.createWindow({title:"Stock Machine",id:"stock"}),l.__views.stock&&l.addTopLevelView(l.__views.stock),o?l.__views.stock.addEventListener("focus",o):h["$.__views.stock!focus!windowFocused"]=!0,a?l.__views.stock.addEventListener("open",a):h["$.__views.stock!open!windowOpened"]=!0,l.__views.__alloyId7=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,backgroundColor:"black",id:"__alloyId7"}),l.__views.stock.add(l.__views.__alloyId7),l.__views.machineWrapper=Ti.UI.createView({width:292,height:339,id:"machineWrapper"}),l.__views.__alloyId7.add(l.__views.machineWrapper),l.__views.machine=Ti.UI.createView({width:180,height:339,backgroundImage:"/images/stock.png",borderColor:"white",borderWidth:2,id:"machine"}),l.__views.machineWrapper.add(l.__views.machine),l.__views.itemWrapper=Ti.UI.createView({width:292,height:339,layout:"vertical",top:4,left:0,id:"itemWrapper"}),l.__views.machineWrapper.add(l.__views.itemWrapper),l.__views.stockOverlayWrapper=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,visible:!1,id:"stockOverlayWrapper"}),l.__views.__alloyId7.add(l.__views.stockOverlayWrapper),n?l.__views.stockOverlayWrapper.addEventListener("click",n):h["$.__views.stockOverlayWrapper!click!hideStockOverlay"]=!0,l.__views.stockOverlayBg=Ti.UI.createView({opacity:.7,backgroundColor:"black",id:"stockOverlayBg"}),l.__views.stockOverlayWrapper.add(l.__views.stockOverlayBg),l.__views.stockOverlay=Ti.UI.createView({width:280,height:180,backgroundColor:"white",borderRadius:8,layout:"vertical",bubbleParent:!1,id:"stockOverlay"}),l.__views.stockOverlayWrapper.add(l.__views.stockOverlay),l.__views.stockTitle=Ti.UI.createLabel({top:16,textAlign:"center",font:{fontSize:24,fontWeight:"bold"},id:"stockTitle"}),l.__views.stockOverlay.add(l.__views.stockTitle),l.__views.stockSlider=Ti.UI.createSlider({top:20,min:0,max:48,width:250,id:"stockSlider"}),l.__views.stockOverlay.add(l.__views.stockSlider),l.__views.stockLevel=Ti.UI.createLabel({top:16,textAlign:"center",font:{fontSize:36,fontWeight:"bold"},id:"stockLevel"}),l.__views.stockOverlay.add(l.__views.stockLevel),c.destroy=function(){},_.extend(l,l.__views);var d,u=Alloy.Globals.machine,p=[];h["$.__views.stock!focus!windowFocused"]&&l.__views.stock.addEventListener("focus",o),h["$.__views.stock!open!windowOpened"]&&l.__views.stock.addEventListener("open",a),h["$.__views.stockOverlayWrapper!click!hideStockOverlay"]&&l.__views.stockOverlayWrapper.addEventListener("click",n),_.extend(l,c)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;